<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ascland.chapter02.RoleMapper">

    <!--定义resultMap-->
    <resultMap id="roleMap" type="com.ascland.chapter02.Role">
        <id property="id" column="id"/>
        <result property="roleName" column="role_name"/>
        <result property="note" column="note"/>
    </resultMap>

    <!--resultType只能引用alias或com.ascland.chapter02.Role-->
    <!--<select id="getRole" parameterType="long" resultType="role">-->
    <!--resultMap只能引用定义的resultMap-->
    <select id="getRole" parameterType="long" resultMap="roleMap">
        SELECT
            id,
            role_name AS roleName,
            note
        FROM t_role
        WHERE id = #{id}
    </select>

    <select id="getRoleAsMap" parameterType="long" resultType="hashmap">
        SELECT
            id,
            role_name AS roleName,
            note
        FROM t_role
        WHERE id = #{id}
    </select>

    <!--统计指定role_name数量-->
    <select id="getRoleCount" parameterType="string" resultType="int">
        SELECT count(*) AS total
        FROM t_role
        WHERE role_name LIKE concat(#{role_name}, '%')
    </select>
    
    <!--sql-->
    <sql id="someSQL">
        ${tableName}.id,${tableName}.role_name
    </sql>

    <select id="getAllRoles" >
        select
        <include refid="someSQL"><property name="tableName" value="t"/></include>
        from t_role
    </select>

    <!--useGeneratedKeys启用主键回填，keyProperty指定哪个是主键字段-->
    <insert id="insertRole" parameterType="role"
            useGeneratedKeys="true">
        INSERT INTO t_role (role_name, note) VALUES (#{roleName}, #{note})
    </insert>

    <!--定义规则生成主键-->
    <insert id="insertRoleSelectKey" parameterType="role"
            useGeneratedKeys="true">
        <selectKey keyProperty="id" resultType="long" order="BEFORE">
            SELECT if(max(id) IS NULL ,1,max(id)+10000) AS newId FROM t_role;
        </selectKey>
        INSERT INTO t_role (id,role_name, note) VALUES (#{id},#{roleName}, #{note})
    </insert>

    <delete id="deleteRole" parameterType="long">
        DELETE FROM t_role
        WHERE id = #{id}
    </delete>
</mapper>